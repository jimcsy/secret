body {
            background-color: #222;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            display: flex; justify-content: center; align-items: center;
            transition: background-color 2s ease;
        }
        body.pink-mode { background-color: #ffc0cb; }

        /* --- CHEST --- */
        #chest-wrapper {
            position: absolute; 
            /* CENTER COORDINATES: Matches end of memories.html */
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(2);
            transition: all 1.5s ease-in-out;
            z-index: 10;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; /* Hidden by default for non-game entry */
        }
        
        #chest-wrapper.from-game { opacity: 1; } /* Instant show if from game */
        #chest-wrapper.show { opacity: 1; }      /* Fade in if fresh load */

        #chest-wrapper.move-right {
            left: 75%; top: 50%;
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        #chest-img {
            width: 200px; height: auto;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
            backface-visibility: hidden;
        }

        /* --- LETTER --- */
        #letter-container {
            position: absolute; left: 10%; top: 50%;
            transform: translateY(-50%); width: 40%;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            opacity: 0; transition: opacity 1s 1s;
        }
        #letter-container.show { opacity: 1; }
        h1 { color: #d63333; margin-top: 0; font-family: 'Poppins', sans-serif; font-weight: 600; }
        p { color: #555; font-size: 17px; line-height: 1.8; }

        /* --- BUTTONS --- */
        #reveal-btn {
            margin-top: 20px; padding: 12px 28px;
            background: #ff6b6b; color: white; border: none; border-radius: 30px;
            font-size: 15px; font-weight: 500; cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
            opacity: 0; pointer-events: none;
            transition: all 0.4s; animation: pulseBtn 2s infinite;
        }
        #reveal-btn.show { opacity: 1; pointer-events: auto; }
        #reveal-btn:hover { transform: scale(1.1); }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- SCRATCH OVERLAY --- */
        #scratch-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s;
        }
        #scratch-overlay.visible { opacity: 1; pointer-events: auto; }

        .scratch-card {
            position: relative; width: 350px; height: 450px;
            background: white; border-radius: 15px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); overflow: hidden;
        }
        .secret-content {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff0f3; z-index: 1; display: flex; align-items: center; justify-content: center;
        }
        .secret-img { width: 100%; height: 100%; object-fit: cover; }
        canvas { position: absolute; top: 0; left: 0; z-index: 2; cursor: crosshair; }

        #hidden-buttons {
            margin-top: 30px; display: flex; gap: 20px;
            opacity: 0; transform: translateY(20px);
            transition: opacity 0.8s, transform 0.8s; pointer-events: none;
        }
        #hidden-buttons.revealed { opacity: 1; transform: translateY(0); pointer-events: auto; }

        .btn { padding: 12px 32px; border: none; border-radius: 50px; font-size: 16px; font-weight: 500; cursor: pointer; transition: transform 0.2s; }
        .btn-yes { background-color: #ff6b6b; color: white; }
        .btn-yes:hover { transform: scale(1.1); background-color: #ff5252; }
        .btn-no { background-color: white; color: #555; }

        .heart { position: absolute; bottom: -50px; color: #ff6b6b; opacity: 0; z-index: 1; animation: floatUp linear forwards; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 0; } 10% { opacity: 0.6; } 100% { transform: translateY(-110vh); opacity: 0; } }